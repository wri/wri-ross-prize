{#
/**
 * @file
 * Default theme implementation to display a single page.
 *
 * The doctype, html, head and body tags are not in this template. Instead they
 * can be found in the html.html.twig template in this directory.
 *
 * Available variables:
 *
 * General utility variables:
 * - base_path: The base URL path of the Drupal installation. Will usually be
 *   "/" unless you have installed Drupal in a sub-directory.
 * - is_front: A flag indicating if the current page is the front page.
 * - logged_in: A flag indicating if the user is registered and signed in.
 * - is_admin: A flag indicating if the user has permission to access
 *   administration pages.
 *
 * Site identity:
 * - front_page: The URL of the front page. Use this instead of base_path when
 *   linking to the front page. This includes the language domain or prefix.
 *
 * Page content (in order of occurrence in the default page.html.twig):
 * - messages: Status and error messages. Should be displayed prominently.
 * - node: Fully loaded node, if there is an automatically-loaded node
 *   associated with the page and the node ID is the second argument in the
 *   page's path (e.g. node/12345 and node/12345/revisions, but not
 *   comment/reply/12345).
 *
 * Regions:
 * - page.header: Items for the header region.
 * - page.primary_menu: Items for the primary menu region.
 * - page.secondary_menu: Items for the secondary menu region.
 * - page.highlighted: Items for the highlighted content region.
 * - page.help: Dynamic help text, mostly for admin pages.
 * - page.content: The main content of the current page.
 * - page.sidebar_first: Items for the first sidebar.
 * - page.sidebar_second: Items for the second sidebar.
 * - page.footer: Items for the footer region.
 * - page.breadcrumb: Items for the breadcrumb region.
 *
 * @see template_preprocess_page()
 * @see html.html.twig
 *
 * @ingroup themeable
 */
#}
<div class="wrapper {% if logged_in %} admin {% endif %}">

    <div class="header">
        <div class="header-bg"></div>
        <!--<div class="header-logo">
          <img src="/themes/wri/images/logo.png" class="logo">
        </div>-->
        {#{ page.header }#}
        <div class="container header__layout">
            <div class="header__headline">
                <div class="header__headline-box">
                    <div class="h1">
                        <div class="date">
                            <!-- B.Y. Edit this block on close -->
                            {% if winner %}
                                <span>2019 Prize Completed</span>
                            {% else %}
                                <span>applications closed -</span> 31 JULY 2018
                            {% endif %}
                        </div>

                        <h1>
                            <span class="yellow">WRI</span> ROSS PRIZE
                            <br/>
                            <span class="span">FOR CITIES</span>
                        </h1>
                        <p>Transformative projects,<br/>igniting citywide change.</p>
                    </div>
                </div>
            </div>

            <div class="header__tiles">
                <!-- B.Y. comment this block on close -->
                <div class="apply">
                    {% if winner %}
                        <span class="text">2019 Winner</span>
                        <span class="arrow" style="left: 238px;"></span>
                        {#            <p style="margin-bottom: 7px;">Congratulations to {{ winner.label }}</p>#}
                        {#            <p>{{ winner.field_place[0].value }}</p>#}
                        <p>A safer walk to a brighter future in Dar es Salaam</p>
                    {% else %}
                        <span class="text">Finalists</span>
                        <span class="arrow"></span>
                        <p>Explore our shortlist of urban innovators</p>
                    {% endif %}
                </div>
                <div class="clearfix"></div>
                <!-- end -->
                <div class="about">
                    <div class="text">About</div>
                </div>
                <div class="finalists">
                    <span class="text">Finalists</span>
                    <span class="arrow"></span>
                    <p>Explore our shortlist of urban innovators</p>
                </div>
                {% if winner %}
                    <div class="container-video winner" data-id="{{ winner.id }}"
                         data-hash="{{ winner.label|replace({' ':''}) }}">
                        <div class="finalists__card-image"
                             style="background-image: url('{{ file_url(winner.field_image[0].entity.fileuri) }}')"></div>
                        <span></span>
                    </div>
                {% else %}
                    <div class="container-video">
                        <div class="video"></div>
                        <span></span>
                    </div>
                {% endif %}
            </div>
        </div>
    </div>

    <div class="menu-c">
        <div class="menu">
            <div class="container">
                <a href="http://wrirosscities.org/">
                    <img src="/themes/wri/images/logo1.png" class="logo" alt=""/>
                </a>
                <span class="menu-icon">
                        <span></span>
                    </span>
                <ul class="menu-list">
                    <li>
                        <a href="#about" class="active">About</a>
                    </li>
                    <li>
                        <a href="#finalists">Finalists</a>
                    </li>
                    <li>
                        <a href="#map">Map</a>
                    </li>
                    <li>
                        <a href="#news">News</a>
                    </li>
                    <li>
                        <a href="#jury">Jury</a>
                    </li>
                    <li>
                        <a href="#advisory_council">Advisory Council</a>
                    </li>
                    <!--<li><a href="#map">Map</a></li>-->
                    <li>
                        <a href="#faq">FAQ</a>
                    </li>
                </ul>
                <!-- B.Y. comment this block on close -->
                {#<div class="right">
                  Apply
                  <span class="arrow"></span>
                  <span class="text">Submit application for consideration</span>
                </div>#}
                <!-- end -->
            </div>
        </div>
    </div>

    <div class="have" id="about">
        {{ page.awards }}
    </div>

    <div class="clearfix"></div>

    <div class="whats">
        {{ page.whats }}
    </div>

    <div class="congratulation">
        <h3>
            <b>Congratulations</b><br> To Sarsai
        </h3>
        <div class="congratulation__content">
            <div class="left">
                <img src="/themes/wri/images/s800.jpg" class="winner-s">
                <div class="winner winner-s">
                    2019 <span>Winner</span>
                </div>
            </div>
            <div class="right">
                <p>In our increasingly complex world, Amend’s School Area Road Safety Assessments and Improvements
                    (SARSAI)
                    stood out to our jury for the simplicity of its evidence-based approach to reversing the escalating
                    crisis of road traffic deaths and injuries.</p>

                <p>It is highly replicable, in a short time, expanding from 2 high-risk school areas in Dar es Salaam,
                    Tanzania, to more than 50 high-risk school areas in 9 countries.</p>

                <p>And it has had an outsized impact on the communities where it has been adopted. By designing from the
                    angle of the child pedestrian, SARSAI benefits the safety and security of all.</p>


                <a href="/sites/default/files/2019-04/2019_WRI_Ross_Prize_for_Cities.pdf" target="_blank" class="more">
                    Read more <span></span>
                </a>
            </div>
        </div>
        <div class="clearfix"></div>
        <div class="quotes__list">
            <h3 class="left">
                <b>Juror</b><br> <span class="quotes-ico">Quotes</span>
            </h3>
            <div class="quote-container">
                <div class="text"> Children and the poor are the ones brutalized
                    by poor planning. SARSAI has created a
                    consciousness that is very powerful. It’s very
                    visceral, emotional. It’s about mortality, making
                    it less brutal, giving people a quality of life.
                </div>
                <div class="text"> These are the tools that help governments
                    make informed decisions.
                </div>
                <div class="clearfix"></div>

                <div class="text"> People want to be educated. But you also need
                    to be able to get to a school, and in many urban
                    environments, that poses the single greatest
                    difficulty, whether you’re talking about Africa or
                    you’re talking about the United States or Europe.
                </div>
                <div class="text">SARSAI gives you so much to build upon for
                    the future. This is about innovation. That’s what
                    will spread.
                </div>
            </div>
        </div>
    </div>
    <div class="clearfix"></div>

    <div class="bg"></div>
    <div class="clearfix"></div>

    <div id="finalists">
        {{ page.finalists }}
    </div>

    <div class="clearfix"></div>

    {% if page.awards_projects %}
        <div class="awards-projects">
            {{ page.awards_projects }}
        </div>

        <div class="bg1"></div>
        <div class="clearfix"></div>
        <div class="bg bg2"></div>
    {% endif %}

    <div id="map">

        <!-- map section -->
        <style>
            .xcontainer {
                max-width: 1200px;
                margin: 0 auto;
                position: relative;
            }

            .xprojects {
                position: relative;
                margin: 0 auto 6rem;
                z-index: 2;
            }

            .xprojects__title {
                font-family: 'AcuminProCond-Bold';
                text-transform: uppercase;
                position: relative;
                margin-bottom: 3rem;
                z-index: 2;
                padding-top: 10rem;
                background-color: white;
                margin-top: 6rem;
            }

            @media screen and (max-width: 570px) {
                .xprojects__title {
                    padding-top: 14rem;
                }
            }

            {# @media (max-width: 370px) {
              .xprojects__sum .span1 {
                font: 30px / 30px'AcuminProCond-Bold';
                color: #fbab1c;
              }
              .xprojects__sum .span2 {
                font: 30px / 30px 'AcuminProCond-Light';
                text-transform: uppercase;
              }
              .xprojects__title {
                padding-top: 5rem;
              }
            } #}
            {# .xprojects__title:before {
              position: absolute;
              content: '';
              width: 138px;
              height: 3px;
              background-color: #fbab1c;
            } #}
            .xprojects__sum {
                position: absolute;
                left: 0;
                top: 0;
                height: 100px;
                z-index: 4;
                width: 100%;
            }

            .xprojects__sum:before {
                position: absolute;
                content: '';
                width: 138px;
                height: 3px;
                background-color: #fbab1c;
            }

            .xprojects__sum .span3 {
                font-size: 1rem;
            }

            .xprojects__more {
                position: absolute;
                z-index: 999999;
                left: 2.2rem;
                bottom: 1%;
                width: 18rem;
                background-color: #fbab1c;
                padding: 1.5rem 2.5rem 1.5rem 1.5rem;
                transform: perspective(314px) rotateY(18deg);
            }

            .xprojects__more:hover {
                transform: perspective(314px) rotateY(24deg);
            }

            .xprojects__more a {
                font-family: 'AcuminProCond-Bold';
                font-size: 2.6rem;
                color: #000;
                text-decoration: none;
                opacity: 1;
            }

            .xprojects__more a:hover {
                opacity: 0.8;
            }

            .xprojects__more p {
                font-size: 1rem;
                padding: 0;
                margin: 0;
            }

            .map {
                width: 100%;
                position: relative;
                padding-bottom: 65%;
                height: 0;
            }

            .map:before {
                position: relative;
                z-index: -1;

            }

            .map__wrap {
                position: absolute !important;
                top: -23%;
                left: 0;
                right: 0;
                bottom: 0;
            }

            .gm-style-iw {
                overflow: visible !important;
            }

            .gm-style-iw div {
                overflow: visible !important;
            }

            .infowindow {
                max-width: 15rem;
                min-width: 15rem;
                position: relative;
                padding: 15px;
            }


            .infowindow__close {
                position: absolute;
                top: 2px;
                right: 2px;
                width: 20px;
                height: 20px;
                cursor: pointer;
                opacity: 1;
                background-color: white;
                border-radius: 50%;
            }

            .infowindow__close:before,
            .infowindow__close:after {
                content: "";
                position: absolute;
                top: 9px;
                left: 2px;
                width: 16px;
                height: 2px;
                background: #afaeae;
            }

            .infowindow__close:hover .infowindow__close:before,
            .infowindow__close:hover .infowindow__close:after {
                background: #575656;
            }

            .infowindow__close:before {
                transform: rotate(45deg);
            }

            .infowindow__close:after {
                webkit-transform: rotate(-45deg);
                transform: rotate(-45deg);
            }

            .gm-style-iw__header,
            .infowindow__header {
                padding: 0 0 0 5rem;;
                position: relative;
            }

            .gm-style-iw__header h3,
            .infowindow__header h3 {
                margin-bottom: 0;
                margin-top: 0;
                font-size: 1.6rem;
                padding-right: 1rem;
            }

            .gm-style-iw__header p,
            .infowindow__header p {
                font-size: 1.2rem;
                padding: 0;
                margin: 0;
            }

            .gm-style-iw__img,
            .infowindow__img {
                object-position: center;
                width: 3rem;
                height: 3rem;
                border-radius: 50%;
                position: absolute;
                left: 10px;
                top: 2px;
                object-fit: cover;
            }

            .infowindow__divider {
                min-width: 400px;
                height: 2px;
                background: #565353;
                margin: 1rem -15px 0;
            }

            .gm-style-iw__content,
            .infowindow__content {
                padding: 1.5rem 0 1.5rem 5rem;
            }

            .gm-style-iw__list,
            .infowindow__list {
                padding-left: 0;
            }

            .gm-style-iw__list li,
            .infowindow__list li {
                list-style: none;
                font-size: 0.9rem;
                line-height: 1.4;
                position: relative;
                font-family: 'AcuminPro-Regular';
            }

            .gm-style-iw__list li:before,
            .infowindow__list li:before {
                position: absolute;
                content: '';
                width: 0.5rem;
                height: 0.5rem;
                background-color: #fbab1c;
                left: -50px;
                top: 0.3rem;
            }

            .gm-style-iw__sum,
            .infowindow__sum {
                position: absolute;
                right: 10px;
                top: 7px;
                font-size: 2.2rem;
                font-family: 'AcuminProCond-Bold';
            }

            .gm-style-iw__line,
            .infowindow__line {
                position: absolute;
                width: 45.3rem;
                left: -1.5rem;
                top: 11rem;
                height: 1px;
                z-index: 9999999999;
                background: #000;
            }

            @media (max-width: 1200px) {
                .xprojects__sum {
                    left: 2rem;
                }
            }
        </style>
        <style>
            /* The location pointed to by the popup tip. */
            .popup-tip-anchor {
                height: 0;
                left: 0;
                position: absolute;
                /* The max width of the info window. */
                width: 600px;
            }

            /* The bubble is anchored above the tip. */
            .popup-bubble-anchor {
                position: absolute;
                width: 100%;
                bottom: 20px;
                left: 5px;
            }

            /* Draw the tip. */
            .popup-bubble-anchor::after {
                content: "";
                position: absolute;
                top: 0;
                left: 0;
                /* Center the tip horizontally. */
                transform: translate(-100%, 0);
                /* The tip is a https://css-tricks.com/snippets/css/css-triangle/ */
                width: 0;
                height: 0;
                /* The tip is 8px high, and 12px wide. */
                border-left: 6px solid transparent;
                border-right: 6px solid transparent;
                border-top: /* TIP_HEIGHT= */ 8px solid white;
            }

            .popup-bubble-anchor.winner-anchor::after {
                left: 0px;
            }

            /* The popup bubble itself. */
            .popup-bubble-content {
                position: absolute;
                top: 0;
                left: 0;
                transform: translate(-50%, -100%);
                /* Style the info window. */
                background-color: white;
                padding: 15px 15px 0 15px;
                border-radius: 3px;
                font-family: sans-serif;
                overflow-y: auto;
                /* max-height: 60px; */
                min-width: 400px;
                box-shadow: 0 2px 10px 1px rgba(0, 0, 0, 0.5);
            }

            .popup-bubble-content.left {
                transform: translate(-20px, -100%);
            }

            .popup-bubble-content.right {
                transform: translate(calc(-100% + 10px), -100%);
            }

            .popup-bubble-content.winner-popup {
                padding: 0;
            }

            .winner-popup {
                display: flex;
                flex-direction: row;
                justify-content: flex-end;
                align-items: center;
                width: 570px;
                box-shadow: 0 10px 20px 0 rgba(0, 0, 0, 0.20);
            }

            .winner-popup__info {
                width: 320px;
            }

            .winner-popup__header {
                font: 37px/1 'AcuminProCond-Bold';
            }

            .winner-popup__desc {
                font: 24px/1 'AcuminProCond-Light';
                margin: 14px auto;
            }

            .winner-popup__place {
                font: 16px/1 'HelveticaNeue-Light';
            }

            .winner-popup__icon {
                margin-right: -32px;
                z-index: 1;
            }

            .winner-popup__icon img {
                width: 63px;
                height: auto;
            }

            .winner-popup__image {
                height: 223px;
            }

            .winner-popup__image img {
                width: 223px;
                height: 223px;
                display: block;
            }
        </style>
        <script>

            /** Defines the Popup class. */
            function definePopupClass() {
                /**
                 * A customized popup on the map.
                 * @param {!google.maps.LatLng} position
                 * @param {!Element} content
                 * @constructor
                 * @extends {google.maps.OverlayView}
                 */
                Popup = function (position, cls, content, anchorClass) {
                    this.position = position;

                    var div = document.createElement("div");
                    div.innerHTML = content;
                    content = div.childNodes[0];
                    content.classList.add('popup-bubble-content');
                    if (cls)
                        content.classList.add(cls);

                    var pixelOffset = document.createElement('div');
                    pixelOffset.classList.add('popup-bubble-anchor');
                    if (anchorClass) {
                        pixelOffset.classList.add(anchorClass);
                    }
                    pixelOffset.appendChild(content);

                    this.anchor = document.createElement('div');
                    this.anchor.classList.add('popup-tip-anchor');
                    this.anchor.appendChild(pixelOffset);

                    // Optionally stop clicks, etc., from bubbling up to the map.
                    this.stopEventPropagation();
                };

                // NOTE: google.maps.OverlayView is only defined once the Maps API has
                // loaded. That is why Popup is defined inside initMap().
                Popup.prototype = Object.create(google.maps.OverlayView.prototype);

                Popup.prototype.open = function () {
                    this.getPanes().floatPane.appendChild(this.anchor);
                };

                Popup.prototype.close = function () {
                    if (this.anchor.parentElement) {
                        this.anchor.parentElement.removeChild(this.anchor);
                    }
                };


                /** Called when the popup needs to draw itself. */
                Popup.prototype.draw = function () {
                    var divPosition = this.getProjection().fromLatLngToDivPixel(this.position);
                    // Hide the popup when it is far out of view.
                    var display =
                        Math.abs(divPosition.x) < 4000 && Math.abs(divPosition.y) < 4000 ?
                            'block' :
                            'none';

                    if (display === 'block') {
                        this.anchor.style.left = divPosition.x + 'px';
                        this.anchor.style.top = divPosition.y + 'px';
                    }
                    if (this.anchor.style.display !== display) {
                        this.anchor.style.display = display;
                    }
                };

                /** Stops clicks/drags from bubbling up to the map. */
                Popup.prototype.stopEventPropagation = function () {
                    var anchor = this.anchor;
                    anchor.style.cursor = 'auto';

                    ['click', 'dblclick', 'contextmenu', 'wheel', 'mousedown', 'touchstart', 'pointerdown']
                        .forEach(function (event) {
                            anchor.addEventListener(event, function (e) {
                                e.stopPropagation();
                            });
                        });
                };
            }

            var data = {{ map|json_encode|raw }};

            function showPopup(id) {
                var id = '#popup-finalists' + id;
                $(id + ", .mask").fadeIn(300);
                $(id).css("top", $(window).scrollTop() + 20);
                $(".wrapper").addClass("opened");
                $("html, body").css("overflow", "hidden");
                jQuery(document).ready(function ($) {
                    $(id).niceScroll({cursorcolor: "#ffae16", autohidemode: false});
                });
            }

            // Google map
            function initMap() {

                definePopupClass();

                var styles = [

                    {
                        "elementType": "geometry",
                        "stylers": [
                            {
                                "color": "#f5f5f5"
                            }
                        ]
                    },
                    {
                        "elementType": "labels",
                        "stylers": [
                            {
                                "visibility": "off"
                            }
                        ]
                    },
                    {
                        "elementType": "labels.icon",
                        "stylers": [
                            {
                                "visibility": "off"
                            }
                        ]
                    },
                    {
                        "elementType": "labels.text.fill",
                        "stylers": [
                            {
                                "color": "#616161"
                            }
                        ]
                    },
                    {
                        "elementType": "labels.text.stroke",
                        "stylers": [
                            {
                                "color": "#f5f5f5"
                            }
                        ]
                    },
                    {
                        "featureType": "administrative",
                        "elementType": "geometry",
                        "stylers": [
                            {
                                "visibility": "off"
                            }
                        ]
                    },
                    {
                        "featureType": "administrative.land_parcel",
                        "stylers": [
                            {
                                "visibility": "off"
                            }
                        ]
                    },
                    {
                        "featureType": "administrative.land_parcel",
                        "elementType": "labels.text.fill",
                        "stylers": [
                            {
                                "color": "#bdbdbd"
                            }
                        ]
                    },
                    {
                        "featureType": "administrative.neighborhood",
                        "stylers": [
                            {
                                "visibility": "off"
                            }
                        ]
                    },
                    {
                        "featureType": "landscape",
                        "stylers": [
                            {
                                "visibility": "off"
                            }
                        ]
                    },
                    {
                        "featureType": "poi",
                        "stylers": [
                            {
                                "color": "#ffc58e"
                            },
                            {
                                "visibility": "off"
                            }
                        ]
                    },
                    {
                        "featureType": "poi",
                        "elementType": "geometry",
                        "stylers": [
                            {
                                "color": "#eeeeee"
                            }
                        ]
                    },
                    {
                        "featureType": "poi",
                        "elementType": "labels.text.fill",
                        "stylers": [
                            {
                                "color": "#757575"
                            }
                        ]
                    },
                    {
                        "featureType": "poi.park",
                        "elementType": "geometry",
                        "stylers": [
                            {
                                "color": "#e5e5e5"
                            }
                        ]
                    },
                    {
                        "featureType": "poi.park",
                        "elementType": "labels.text.fill",
                        "stylers": [
                            {
                                "color": "#9e9e9e"
                            }
                        ]
                    },
                    {
                        "featureType": "road",
                        "stylers": [
                            {
                                "visibility": "off"
                            }
                        ]
                    },
                    {
                        "featureType": "road",
                        "elementType": "geometry",
                        "stylers": [
                            {
                                "color": "#ffffff"
                            }
                        ]
                    },
                    {
                        "featureType": "road",
                        "elementType": "labels.icon",
                        "stylers": [
                            {
                                "visibility": "off"
                            }
                        ]
                    },
                    {
                        "featureType": "road.arterial",
                        "elementType": "labels.text.fill",
                        "stylers": [
                            {
                                "color": "#757575"
                            }
                        ]
                    },
                    {
                        "featureType": "road.highway",
                        "elementType": "geometry",
                        "stylers": [
                            {
                                "color": "#dadada"
                            }
                        ]
                    },
                    {
                        "featureType": "road.highway",
                        "elementType": "labels.text.fill",
                        "stylers": [
                            {
                                "color": "#616161"
                            }
                        ]
                    },
                    {
                        "featureType": "road.local",
                        "elementType": "labels.text.fill",
                        "stylers": [
                            {
                                "color": "#9e9e9e"
                            }
                        ]
                    },
                    {
                        "featureType": "transit",
                        "stylers": [
                            {
                                "visibility": "off"
                            }
                        ]
                    },
                    {
                        "featureType": "transit.line",
                        "elementType": "geometry",
                        "stylers": [
                            {
                                "color": "#e5e5e5"
                            }
                        ]
                    },
                    {
                        "featureType": "transit.station",
                        "elementType": "geometry",
                        "stylers": [
                            {
                                "color": "#eeeeee"
                            }
                        ]
                    },
                    {
                        "featureType": "water",
                        "elementType": "geometry",
                        "stylers": [
                            {
                                "color": "#ffffff"
                            }
                        ]
                    },
                    {
                        "featureType": "water",
                        "elementType": "labels",
                        "stylers": [
                            {
                                "visibility": "off"
                            }
                        ]
                    },
                    {
                        "featureType": "water",
                        "elementType": "labels.text.fill",
                        "stylers": [
                            {
                                "color": "#9e9e9e"
                            }
                        ]
                    }

                ];

                var zoomMap;

                if (/Android|webOS|iPhone|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)) {
                    zoomMap = 0.5;
                } else if (/webOS|iPad/i.test(navigator.userAgent)) {
                    zoomMap = 1.6;
                } else {
                    zoomMap = 2.1;
                }


                var map = new google.maps.Map(document.getElementById('gmap'), {
                    center: {lat: 56, lng: 10},
                    zoom: zoomMap,
                    // maxZoom: 2.1,
                    // draggable: false,
                    // scaleControl: false,
                    // scrollwheel: true,
                    disableDefaultUI: false,
                    streetViewControl: false,
                    mapTypeControlOptions: {
                        mapTypeIds: []
                    },
                    optimized: false,
                });

                var currentPopup;
                google.maps.event.addListener(map, "click", function () {
                    if (currentPopup)
                        currentPopup.close();
                });

                document.addEventListener('keyup', function (e) {
                    if (e.keyCode == 27 && currentPopup)
                        currentPopup.close();
                });

                data.forEach(function (d) {
                    var anchor;
                    d.map = map;
                    if (anchor = (d.icon || {}).anchor) {
                        d.icon.anchor = new google.maps.Point(anchor[0], anchor[1]);
                    }
                    var m = new google.maps.Marker(d);
                    var anchorClass = '';
                    if (d.city) {
                        var projects = [];
                        d.projects.forEach(function (name) {
                            projects.push("<li class=\"infowindow__item\">" + name + "</li>");
                        });
                        var contentString =
                            '<div class="infowindow">' +
                            '<span class="infowindow__close"></span>' +
                            '<div class="infowindow__header">' +
                                {# `<img class="infowindow__img" src="/themes/wri/images/flags/${d.country_code.trim().toLowerCase()}.svg">` + #}
                            '<img class="infowindow__img" src="/themes/wri/images/flags/' + d.country_code.trim().toLowerCase() + '.svg">' +
                            '<h3>' + d.city + '</h3>' +
                            '<p>' + d.country.trim() + '</p>' +
                            '<span class="infowindow__sum">' + d.projects.length + '</span>' +
                            '</div>' +
                            '<div class="infowindow__divider"></div>' +
                            '<div class="infowindow__content">' +
                            '<ul class="infowindow__list">' +
                            projects.join("") +
                            '</ul>' +
                            '</div>' +
                            '</span>';
                    } else {
                        var contentString =
                            '<div class="winner-popup">' +
                            '<span class="infowindow__close"></span>' +
                            '<div class="winner-popup__info">' +
                            '<div class="winner-popup__header" onclick="showPopup(' + d.id + ');">' + d.title + '</div>' +
                            '<div class="winner-popup__desc">' + d.sub_title + '</div>' +
                            '<div class="winner-popup__place">' + d.place + '</div>' +
                            '</div>' +
                                {#`<div class="winner-popup__image"><img src="${d.image}" alt=""></div>` + #}
                            '<div class="winner-popup__image"><img src="' + d.image + '" alt=""></div>' +
                            '</div>';
                        anchorClass = 'winner-anchor';
                    }

                    var cls = d.position.lng < -99 ? 'left' : d.position.lng > 110 ? 'right' : '';
                    var popup = new Popup(new google.maps.LatLng(d.position.lat, d.position.lng), cls, contentString, anchorClass);
                    popup.setMap(map);
                    google.maps.event.addListener(m, "click", function () {
                        if (currentPopup)
                            currentPopup.close();
                        popup.open(map, m);
                        currentPopup = popup;
                        var closePopupBtn = currentPopup.anchor.querySelector('.infowindow__close');
                        closePopupBtn.addEventListener('click', function () {
                            currentPopup.close();
                        });
                    });
                });
                map.setOptions({styles: styles});
            }

        </script>

        <section class="xprojects">
            <div class="xcontainer">
                <div class="xprojects__sum">
                    <div class="span1">{{ projects_count }}</div>
                    <div class="span2">Applications received</div>
                    <!--<div class="span3">Sparking Transformative <br>Change</div>-->
                </div>
                <h2 class="xprojects__title">&nbsp;</h2>
                <div class="map">
                    <div class="map__wrap" id="gmap"></div>
                </div>
            </div>

            <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBYJlQ_P1Sc4QZItwJGwG5E_G2pdmlcQPQ&callback=initMap"
                    async="async" defer="defer"></script>
        </section>

    </div>

    <div class="clearfix"></div>

    <div class="news" id="news">
        <h4><span>OUR</span> NEWS</h4>
        {{ page.news }}
        <div class="clearfix"></div>
        <div class="register">
            <p><span>Register</span> to Receive Our News
                and Announcements</p>
            <form class="popup__subscribe-form" method="post">
                <button class="subscribe">Subscribe</button>
            </form>
            {{ page.subscribe }}
        </div>
    </div>

    <div class="clearfix"></div>

    <div class="photos" id="jury">
        {{ page.jury }}
    </div>

    <div class="bg3"></div>
    <div class="clearfix"></div>
    <div class="bg4"></div>

    <div class="people" id="advisory_council">
        {{ page.council }}
    </div>

    <div class="faq" id="faq">
        <div class="container">
            <a href="#" class="title">FAQ</a>
            {{ page.faq }}
            <a href="#" class="more"><span class="span">SEE MORE</span><span class="arrow"></span></a>
            <a href="javascript:void(0);" class="contact">
                <span class="text">Contact Us</span>
                <span class="arrow"></span>
                <span class="text1">For any information</span>
            </a>
        </div>

    </div>
    <div class="footer">
        {{ page.footer }}
    </div>

</div>

<div class="popup-form subscribe-form popup-wrapper">
    <div class="close subscribe-form__close"></div>
    <div class="popup__headline">
        <div class="title subscribe-form__title"><span>Subscribe</span></div>
    </div>
    <div class="popup-form__body">
        <iframe src="//connect.wri.org/l/120942/2017-10-11/3l9bpy" width="100%" height="100%" type="text/html"
                frameborder="0"
                allowTransparency="true" style="border: 0"></iframe>
    </div>
</div>

<div class="popup-video" style="display: none">
    <div class="close"></div>
    <div class="iframe"></div>
</div>

<div class="popup__container popup-decided">
    <div class="popup">
        <div class="popup__close">
            <img src="/themes/wri/images/close.png" alt="">
        </div>

        <div class="popup__headline">
            <div class="popup__company">
                <div class="popup__header">{{ decided_block_label }}</div>
            </div>
        </div>

        <div class="popup__row">
            <div class="popup__paragraph popup__paragraph_full-width">
                {{ decided_block.field_name }}
            </div>
        </div>

        <div class="popup__cover">
            {{ decided_block.field_image }}
        </div>

        <div class="popup__row">
            <div class="popup__paragraph popup__paragraph_full-width">
                {{ decided_block.body }}
            </div>
        </div>
    </div>
</div>

<div class="mask"></div>

